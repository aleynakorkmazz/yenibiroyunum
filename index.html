<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aleyna Korkmaz | Oyun1 v4.0 (Pro)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #00cec9;
            --accent: #fd79a8;
            --dark: #2d3436;
            --light: #dfe6e9;
            --bg-grad: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background: var(--bg-grad); color: var(--dark); min-height: 100vh; user-select: none; }

        /* --- NAVİGASYON (Aynı Kaldı) --- */
        nav { background: rgba(255, 255, 255, 0.95); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); cursor: pointer; }
        .nav-links { display: flex; gap: 30px; }
        .nav-item { cursor: pointer; font-weight: 600; transition: 0.3s; color: var(--dark); }
        .nav-item:hover { color: var(--primary); }

        /* --- HERO --- */
        header.hero { text-align: center; padding: 60px 20px 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 0 0 40px 40px; box-shadow: 0 10px 30px rgba(118, 75, 162, 0.3); margin-bottom: 40px; }
        .hero h1 { font-size: 3rem; margin: 0; font-weight: 800; }
        .tagline { background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; margin-top: 10px; display: inline-block; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px 40px; }

        /* --- ANA SAYFA KARTLARI --- */
        .home-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .feature-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.05); transition: 0.3s; cursor: pointer; border: 1px solid rgba(0,0,0,0.05); }
        .feature-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .card-icon { height: 120px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: white; }
        .icon-notes { background: linear-gradient(45deg, #ff9a9e, #fad0c4); }
        .icon-games { background: linear-gradient(45deg, #a18cd1, #fbc2eb); }
        .icon-movies { background: linear-gradient(45deg, #84fab0, #8fd3f4); }
        .card-body { padding: 25px; text-align: center; }
        .card-body h3 { margin: 0 0 10px; color: var(--dark); font-size: 1.5rem; }
        .card-body p { color: #777; font-size: 0.9rem; margin: 0; }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 2000; justify-content: center; align-items: center; animation: fadeIn 0.3s ease; }
        .modal-content { background: #f8f9fa; width: 95%; max-width: 1200px; max-height: 90vh; border-radius: 20px; overflow-y: auto; position: relative; display: flex; flex-direction: column; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 2rem; cursor: pointer; color: #555; z-index: 100; }

        /* --- DERS İÇERİK STİLLERİ (Aynı) --- */
        .topic-container { padding: 30px; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .topic-group { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .topic-head { font-size: 1.1rem; font-weight: 700; color: var(--primary); margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .card { background: #fff; padding: 10px; border-radius: 8px; border-left: 4px solid var(--secondary); margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card h5 { margin: 0; color: #d63031; font-size: 0.9rem; } .card p { font-size: 0.8rem; color: #555; margin: 5px 0 0; }
        .subject-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; padding: 30px; }
        .sub-btn { padding: 20px; text-align: center; background: white; border-radius: 12px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-left: 5px solid #ccc; transition: 0.2s; }
        .sub-btn:hover { transform: scale(1.05); }

        /* --- GELİŞMİŞ OYUN ALANI STİLLERİ --- */
        #game-modal-content { 
            background: #111; color: white; display: flex; flex-direction: column; align-items: center; 
            padding: 20px; border-radius: 20px; border: 2px solid #333; box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        canvas { 
            background: #000; border: 4px solid #444; border-radius: 8px; margin: 10px 0; 
            box-shadow: 0 0 30px rgba(108, 92, 231, 0.2); 
        }
        .game-controls { display: flex; gap: 30px; font-family: 'Courier New', monospace; font-size: 1.4rem; font-weight: bold; margin-bottom: 10px; }
        .stat-box span { color: var(--secondary); text-shadow: 0 0 10px var(--secondary); }
        
        .game-overlay { 
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); flex-direction: column; justify-content: center; align-items: center; z-index: 50; 
        }
        .btn-play { background: var(--success); color: white; padding: 15px 40px; border: none; border-radius: 50px; font-size: 1.2rem; cursor: pointer; margin: 10px; font-weight: bold; transition:0.3s; }
        .btn-play:hover { transform: scale(1.1); box-shadow: 0 0 20px var(--success); }
        .btn-exit { background: transparent; color: white; border: 2px solid white; padding: 10px 30px; border-radius: 50px; cursor: pointer; transition:0.3s; }
        .btn-exit:hover { background: white; color: black; }

        /* Dokunmatik Kontroller */
        .touch-controls { display: grid; grid-template-columns: 60px 60px 60px; gap: 10px; margin-top: 20px; }
        .t-btn { width: 60px; height: 60px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 10px; color: white; font-size: 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center; user-select: none; }
        .t-btn:active { background: var(--primary); }
        .t-up { grid-column: 2; } .t-left { grid-column: 1; } .t-down { grid-column: 2; } .t-right { grid-column: 3; }

        /* --- CINEBOT STYLES --- */
        .ai-widget-btn { position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px; background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; cursor: pointer; box-shadow: 0 10px 25px rgba(108, 92, 231, 0.4); z-index: 3000; animation: pulse 2s infinite; }
        .chat-container { position: fixed; bottom: 110px; right: 30px; width: 360px; height: 500px; background: white; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.25); z-index: 2999; display: none; flex-direction: column; overflow: hidden; }
        .chat-header { background: var(--primary); color: white; padding: 15px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #fff; }
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 85%; font-size: 0.9rem; line-height: 1.4; }
        .bot { background: #f1f0f0; color: #333; align-self: flex-start; }
        .user { background: var(--primary); color: white; align-self: flex-end; }
        .chat-input-area { padding: 10px; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        .chat-send { background: var(--primary); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(108, 92, 231, 0); } 100% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="location.reload()">Aleyna Korkmaz</div>
        <div class="nav-links">
            <div class="nav-item" onclick="openNotes()">Ders Notları</div>
            <div class="nav-item" onclick="openGameMenu()">Oyunlar</div>
            <div class="nav-item" onclick="toggleChat(true)">CineBot</div>
        </div>
    </nav>

    <header class="hero">
        <h1>Hoş Geldiniz</h1>
        <p>Matematik Öğrencisi & Veri Analisti Adayı</p>
        <div class="tagline">Oyun1 v4.0 | Pro Sürüm</div>
    </header>

    <div class="container">
        <div class="home-grid">
            <div class="feature-card" onclick="openNotes()">
                <div class="card-icon icon-notes"><i class="fa-solid fa-book-open"></i></div>
                <div class="card-body"><h3>Ders Notları</h3><p>Tüm YKS Müfredatı.</p></div>
            </div>
            <div class="feature-card" onclick="openGameMenu()">
                <div class="card-icon icon-games"><i class="fa-solid fa-gamepad"></i></div>
                <div class="card-body"><h3>Oyunlar (Gelişmiş)</h3><p>60 FPS Akıcı Snake, Tetris, Pacman.</p></div>
            </div>
            <div class="feature-card" onclick="toggleChat(true)">
                <div class="card-icon icon-movies"><i class="fa-solid fa-robot"></i></div>
                <div class="card-body"><h3>CineBot</h3><p>Yapay Zeka Film Önerisi.</p></div>
            </div>
        </div>
    </div>

    <div id="notesModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('notesModal')">&times;</span>
            <div style="padding: 20px;">
                <h2 style="text-align:center;">Ders Seçiniz</h2>
                <div class="subject-grid">
                    <div class="sub-btn" style="border-left-color:#e17055" onclick="loadSubject('Matematik')">Matematik</div>
                    <div class="sub-btn" style="border-left-color:#0984e3" onclick="loadSubject('Fizik')">Fizik</div>
                    <div class="sub-btn" style="border-left-color:#6c5ce7" onclick="loadSubject('Kimya')">Kimya</div>
                    <div class="sub-btn" style="border-left-color:#00b894" onclick="loadSubject('Biyoloji')">Biyoloji</div>
                    <div class="sub-btn" style="border-left-color:#fdcb6e" onclick="loadSubject('Tarih')">Tarih</div>
                    <div class="sub-btn" style="border-left-color:#e84393" onclick="loadSubject('Coğrafya')">Coğrafya</div>
                    <div class="sub-btn" style="border-left-color:#636e72" onclick="loadSubject('Edebiyat')">Edebiyat</div>
                </div>
                <div id="topicContainer" class="topic-container"></div>
            </div>
        </div>
    </div>

    <div id="gamesMenuModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center; padding: 40px; background:#2d3436;">
            <span class="close-btn" style="color:white;" onclick="closeModal('gamesMenuModal')">&times;</span>
            <h2 style="color:white;">Oyun Seç</h2>
            <button class="btn-play" style="width:100%; background:#6c5ce7;" onclick="initGame('snake')">Neon Yılan</button>
            <button class="btn-play" style="width:100%; background:#0984e3;" onclick="initGame('tetris')">Pro Tetris</button>
            <button class="btn-play" style="width:100%; background:#fd79a8;" onclick="initGame('pacman')">Arcade Pacman</button>
        </div>
    </div>

    <div id="gameModal" class="modal" style="background: black;">
        <div id="game-modal-content">
            <div style="width: 100%; display:flex; justify-content:space-between; align-items:center;">
                <h3 id="gameTitle" style="margin:0; color:#f1c40f;">Oyun</h3>
                <span onclick="stopGame()" style="color:white; cursor:pointer; border:1px solid white; padding:5px 15px; border-radius:20px;">KAPAT</span>
            </div>
            
            <div style="position: relative;">
                <div id="gameOverOverlay" class="game-overlay">
                    <h1 style="color:var(--accent); font-size:3rem;">OYUN BİTTİ</h1>
                    <p style="color:white; font-size:1.5rem;">SKOR: <span id="finalScore">0</span></p>
                    <button class="btn-play" onclick="restart()">TEKRAR</button>
                    <button class="btn-exit" onclick="stopGame()">ÇIKIŞ</button>
                </div>
                <canvas id="gameCanvas"></canvas>
            </div>
            
            <div class="game-controls">
                <div class="stat-box">Skor: <span id="scoreVal">0</span></div>
                <div class="stat-box">Lvl: <span id="levelVal">1</span></div>
                <div class="stat-box" id="livesContainer">Can: <span id="livesVal">3</span></div>
            </div>

            <div class="touch-controls">
                <div></div><div class="t-btn t-up" onmousedown="handleInput('ArrowUp')" ontouchstart="handleInput('ArrowUp')"><i class="fa-solid fa-arrow-up"></i></div><div></div>
                <div class="t-btn t-left" onmousedown="handleInput('ArrowLeft')" ontouchstart="handleInput('ArrowLeft')"><i class="fa-solid fa-arrow-left"></i></div>
                <div class="t-btn t-down" onmousedown="handleInput('ArrowDown')" ontouchstart="handleInput('ArrowDown')"><i class="fa-solid fa-arrow-down"></i></div>
                <div class="t-btn t-right" onmousedown="handleInput('ArrowRight')" ontouchstart="handleInput('ArrowRight')"><i class="fa-solid fa-arrow-right"></i></div>
            </div>
        </div>
    </div>

    <div class="ai-widget-btn" onclick="toggleChat()"><i class="fa-solid fa-comment-dots"></i></div>
    <div id="cineBot" class="chat-container">
        <div class="chat-header"><span><i class="fa-solid fa-film"></i> CineBot</span><span style="cursor:pointer" onclick="toggleChat()">&times;</span></div>
        <div id="chatView" class="chat-body"><div class="msg bot">Merhaba! fullhdfilmizlesene.tv'den film önerebilirim. Tür yaz (Aksiyon, Korku vb.).</div></div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" class="chat-input" placeholder="Tür yaz..." onkeypress="handleEnter(event)">
            <button class="chat-send" onclick="sendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        /* --- VERİTABANI (Ders & Film) --- */
        const curriculum={"Matematik":[{t:"Temel Kavramlar",c:[{h:"Rakam",t:"{0..9}"}]},{t:"Türev",c:[{h:"Teğet",t:"Eğim."}]}], "Fizik":[{t:"Kuvvet",c:[{h:"F=ma",t:"Newton."}]}], "Kimya":[{t:"Atom",c:[{h:"Proton",t:"+"}]}], "Biyoloji":[{t:"Hücre",c:[{h:"ATP",t:"Enerji"}]}], "Tarih":[{t:"İlk Türkler",c:[{h:"Kut",t:"Yetki"}]}], "Coğrafya":[{t:"İklim",c:[{h:"Basınç",t:"Hava"}]}], "Edebiyat":[{t:"Şiir",c:[{h:"Redif",t:"Ek"}]}]};
        const movies=[{t:"Inception",g:["bilim kurgu"],d:"Rüya hırsızlığı."},{t:"The Dark Knight",g:["aksiyon"],d:"Joker vs Batman."},{t:"Interstellar",g:["bilim kurgu"],d:"Uzay yolculuğu."},{t:"The Conjuring",g:["korku"],d:"Perili ev."},{t:"Titanic",g:["romantik"],d:"Batan gemi."},{t:"Avengers",g:["aksiyon"],d:"Süper kahramanlar."}];

        /* --- SİTE FONKSİYONLARI --- */
        function openNotes(){document.getElementById('notesModal').style.display='flex';}
        function openGameMenu(){document.getElementById('gamesMenuModal').style.display='flex';}
        function openMovies(){toggleChat(true);}
        function closeModal(id){document.getElementById(id).style.display='none';}
        function toggleChat(f){const c=document.getElementById('cineBot'); if(f)c.style.display='flex'; else c.style.display=c.style.display==='flex'?'none':'flex';}
        function loadSubject(s){const c=document.getElementById('topicContainer'); c.innerHTML=curriculum[s]?curriculum[s].map(t=>`<div class="topic-group"><div class="topic-head">${t.t}</div>${t.c.map(x=>`<div class="card"><h5>${x.h}</h5><p>${x.t}</p></div>`).join('')}</div>`).join(''):"İçerik yükleniyor...";}
        function sendMessage(){
            const i=document.getElementById('chatInput'); const v=i.value.trim().toLowerCase(); if(!v)return;
            addMsg(v,'user'); i.value='';
            setTimeout(()=>{
                const m=movies.filter(x=>x.g.some(g=>v.includes(g)));
                if(m.length){const r=m[Math.floor(Math.random()*m.length)]; addMsg(`Öneri: <b>${r.t}</b><br>${r.d}<br><a href="https://www.fullhdfilmizlesene.tv/arama/${r.t}" target="_blank" style="color:blue">İzle</a>`,'bot');}
                else addMsg("Bulunamadı.",'bot');
            },500);
        }
        function addMsg(t,c){const d=document.createElement('div');d.className=`msg ${c}`;d.innerHTML=t;document.getElementById('chatView').append(d);}
        function handleEnter(e){if(e.key==='Enter')sendMessage();}

        /* --- GELİŞMİŞ OYUN MOTORU (60 FPS LOOP) --- */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let animationId, lastTime = 0;
        let activeGame = null;
        let gameState = { score:0, level:1, lives:3, gameOver:false, paused:false };
        
        // Oyun Değişkenleri
        let snake, food, snakeDir, particles=[];
        let pacman, ghosts, map, dots;
        let tetrisBoard, piece, ghostPiece;

        function initGame(game) {
            document.getElementById('gamesMenuModal').style.display = 'none';
            document.getElementById('gameModal').style.display = 'flex';
            document.getElementById('gameTitle').innerText = game.toUpperCase();
            activeGame = game;
            restart();
        }

        function stopGame() {
            cancelAnimationFrame(animationId);
            document.getElementById('gameModal').style.display = 'none';
        }

        function restart() {
            document.getElementById('gameOverOverlay').style.display = 'none';
            gameState = { score:0, level:1, lives:3, gameOver:false, paused:false };
            particles = [];
            
            if(activeGame === 'snake') {
                canvas.width = 400; canvas.height = 400;
                document.getElementById('livesContainer').style.display = 'none';
                initSnake();
            } else if(activeGame === 'tetris') {
                canvas.width = 240; canvas.height = 400;
                document.getElementById('livesContainer').style.display = 'none';
                initTetris();
            } else if(activeGame === 'pacman') {
                canvas.width = 448; canvas.height = 496; // 28x31 tiles * 16px
                document.getElementById('livesContainer').style.display = 'block';
                initPacman();
            }
            
            lastTime = 0;
            cancelAnimationFrame(animationId);
            gameLoop(0);
        }

        function gameLoop(timestamp) {
            if(gameState.gameOver) return;
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;

            update(deltaTime);
            draw();
            animationId = requestAnimationFrame(gameLoop);
        }

        function updateUI() {
            document.getElementById('scoreVal').innerText = gameState.score;
            document.getElementById('levelVal').innerText = gameState.level;
            document.getElementById('livesVal').innerText = "❤️".repeat(gameState.lives);
        }

        function setGameOver() {
            gameState.gameOver = true;
            document.getElementById('finalScore').innerText = gameState.score;
            document.getElementById('gameOverOverlay').style.display = 'flex';
        }

        /* --- 1. NEON SNAKE --- */
        let snakeTimer = 0;
        function initSnake() {
            snake = [{x:10, y:10}, {x:9, y:10}, {x:8, y:10}];
            food = {x:15, y:15};
            snakeDir = {x:1, y:0};
        }
        function updateSnake(dt) {
            snakeTimer += dt;
            if(snakeTimer > Math.max(50, 150 - (gameState.level*5))) {
                snakeTimer = 0;
                const head = {x: snake[0].x + snakeDir.x, y: snake[0].y + snakeDir.y};
                
                // Duvar çarpışma
                if(head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || snake.some(s => s.x === head.x && s.y === head.y)) {
                    setGameOver(); return;
                }

                snake.unshift(head);
                if(head.x === food.x && head.y === food.y) {
                    gameState.score += 10;
                    if(gameState.score % 50 === 0) gameState.level++;
                    spawnParticles(head.x*20+10, head.y*20+10, "#e74c3c");
                    food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)};
                    updateUI();
                } else {
                    snake.pop();
                }
            }
            updateParticles();
        }
        function drawSnake() {
            ctx.fillStyle = "#111"; ctx.fillRect(0,0,400,400);
            // Grid
            ctx.strokeStyle = "#222"; ctx.lineWidth=1;
            for(let i=0; i<=400; i+=20) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,400); ctx.stroke(); ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(400,i); ctx.stroke(); }
            
            // Food
            ctx.fillStyle = "#ff4757";
            ctx.shadowBlur = 15; ctx.shadowColor = "#ff4757";
            ctx.beginPath(); ctx.arc(food.x*20+10, food.y*20+10, 8, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;

            // Snake
            snake.forEach((s, i) => {
                ctx.fillStyle = i===0 ? "#2ecc71" : "#27ae60";
                if(i===0) { ctx.shadowBlur = 10; ctx.shadowColor = "#2ecc71"; }
                ctx.fillRect(s.x*20+1, s.y*20+1, 18, 18);
                ctx.shadowBlur = 0;
                // Eyes
                if(i===0) {
                    ctx.fillStyle="white";
                    ctx.fillRect(s.x*20+5, s.y*20+5, 4, 4);
                    ctx.fillRect(s.x*20+11, s.y*20+5, 4, 4);
                }
            });
            drawParticles();
        }

        /* --- 2. PRO TETRIS --- */
        let tetrisTimer = 0;
        const SHAPES = [[[1,1,1,1]], [[1,1],[1,1]], [[0,1,0],[1,1,1]], [[1,1,0],[0,1,1]], [[0,1,1],[1,1,0]], [[1,0,0],[1,1,1]], [[0,0,1],[1,1,1]]];
        const COLORS = ["#00f0f0", "#f0f000", "#a000f0", "#00f000", "#f00000", "#0000f0", "#f0a000"];
        
        function initTetris() {
            tetrisBoard = Array(20).fill().map(() => Array(12).fill(null));
            spawnTetrisPiece();
        }
        function spawnTetrisPiece() {
            const id = Math.floor(Math.random() * SHAPES.length);
            piece = { shape: SHAPES[id], color: COLORS[id], x: 4, y: 0 };
            ghostPiece = { ...piece }; // Clone for ghost
        }
        function updateTetris(dt) {
            tetrisTimer += dt;
            if(tetrisTimer > Math.max(100, 500 - (gameState.level*20))) {
                tetrisTimer = 0;
                movePiece(0, 1);
            }
            // Update Ghost
            ghostPiece = { ...piece };
            while(!checkCollision(ghostPiece.x, ghostPiece.y + 1, ghostPiece.shape)) {
                ghostPiece.y++;
            }
        }
        function movePiece(dx, dy) {
            if(!checkCollision(piece.x + dx, piece.y + dy, piece.shape)) {
                piece.x += dx; piece.y += dy;
            } else if(dy > 0) {
                lockPiece();
            }
        }
        function rotatePiece() {
            const rotated = piece.shape[0].map((_, i) => piece.shape.map(row => row[i]).reverse());
            if(!checkCollision(piece.x, piece.y, rotated)) piece.shape = rotated;
        }
        function hardDrop() {
            while(!checkCollision(piece.x, piece.y + 1, piece.shape)) piece.y++;
            lockPiece();
        }
        function checkCollision(x, y, shape) {
            return shape.some((row, r) => row.some((val, c) => {
                if(!val) return false;
                const newX = x + c; const newY = y + r;
                return newX < 0 || newX >= 12 || newY >= 20 || (newY >= 0 && tetrisBoard[newY][newX]);
            }));
        }
        function lockPiece() {
            piece.shape.forEach((row, r) => row.forEach((val, c) => {
                if(val) {
                    if(piece.y + r < 0) { setGameOver(); return; }
                    tetrisBoard[piece.y + r][piece.x + c] = piece.color;
                }
            }));
            // Line clear
            for(let r=19; r>=0; r--) {
                if(tetrisBoard[r].every(c => c)) {
                    tetrisBoard.splice(r, 1);
                    tetrisBoard.unshift(Array(12).fill(null));
                    gameState.score += 100;
                    r++; // Recheck same row
                }
            }
            updateUI();
            spawnTetrisPiece();
        }
        function drawTetris() {
            ctx.fillStyle = "#000"; ctx.fillRect(0,0,240,400);
            // Board
            tetrisBoard.forEach((row, y) => row.forEach((color, x) => {
                if(color) drawBlock(x, y, color);
            }));
            // Ghost
            ghostPiece.shape.forEach((row, r) => row.forEach((val, c) => {
                if(val) {
                    ctx.fillStyle = "rgba(255,255,255,0.2)";
                    ctx.fillRect((ghostPiece.x+c)*20, (ghostPiece.y+r)*20, 20, 20);
                    ctx.strokeStyle = "rgba(255,255,255,0.5)";
                    ctx.strokeRect((ghostPiece.x+c)*20, (ghostPiece.y+r)*20, 20, 20);
                }
            }));
            // Piece
            piece.shape.forEach((row, r) => row.forEach((val, c) => {
                if(val) drawBlock(piece.x+c, piece.y+r, piece.color);
            }));
        }
        function drawBlock(x, y, color) {
            ctx.fillStyle = color; ctx.fillRect(x*20, y*20, 20, 20);
            ctx.strokeStyle = "#000"; ctx.lineWidth=2; ctx.strokeRect(x*20, y*20, 20, 20);
        }

        /* --- 3. ARCADE PACMAN --- */
        let pacTimer = 0;
        const PMAP = [
            "WWWWWWWWWWWWWWWWWWWWWWWWWWWW",
            "W............WW............W",
            "W.WWWW.WWWWW.WW.WWWWW.WWWW.W",
            "W*WWWW.WWWWW.WW.WWWWW.WWWW*W",
            "W.WWWW.WWWWW.WW.WWWWW.WWWW.W",
            "W..........................W",
            "W.WWWW.WW.WWWWWWWW.WW.WWWW.W",
            "W.WWWW.WW.WWWWWWWW.WW.WWWW.W",
            "W......WW....WW....WW......W",
            "WWWWWW.WWWWW WW WWWWW.WWWWWW",
            "     W.WW          WW.W     ",
            "     W.WW WWWWWWWW WW.W     ",
            "WWWWWW.WW W      W WW.WWWWWW",
            "      .   W      W   .      ",
            "WWWWWW.WW W      W WW.WWWWWW",
            "     W.WW WWWWWWWW WW.W     ",
            "     W.WW          WW.W     ",
            "WWWWWW.WW WWWWWWWW WW.WWWWWW",
            "W............WW............W",
            "W.WWWW.WWWWW.WW.WWWWW.WWWW.W",
            "W*..WW................WW..*W",
            "WWW.WW.WW.WWWWWWWW.WW.WW.WWW",
            "WWW.WW.WW.WWWWWWWW.WW.WW.WWW",
            "W......WW....WW....WW......W",
            "W.WWWWWWWWWW.WW.WWWWWWWWWW.W",
            "W..........................W",
            "WWWWWWWWWWWWWWWWWWWWWWWWWWWW"
        ]; // 28x27 grid?
        // Map parsing is tricky in limited code. Simplified approach:
        // 16px tiles.
        
        function initPacman() {
            pacman = {x:13.5, y:23, dir:0, nextDir:0, speed:0.1}; // Grid coords
            // Simple Ghosts
            ghosts = [
                {x:13.5, y:11, color:"red", speed:0.08},
                {x:14.5, y:11, color:"pink", speed:0.08}
            ];
            totalDots = 0;
            for(let s of PMAP) totalDots += (s.match(/\./g)||[]).length;
        }
        
        function updatePacman(dt) {
            // Simplified movement for robustness:
            // Pacman moves in grid coordinates smoothly
            // Collision check against PMAP strings
            
            // Move Pacman
            moveEntity(pacman);
            
            // Check Dots
            let gx = Math.round(pacman.x), gy = Math.round(pacman.y);
            let row = PMAP[gy];
            if(row && row[gx] === '.') {
                PMAP[gy] = row.substring(0,gx) + " " + row.substring(gx+1);
                gameState.score += 10;
            }
            
            // Move Ghosts (Random logic for demo)
            ghosts.forEach(g => {
                if(Math.random() < 0.05) g.dir = Math.floor(Math.random()*4); // Change dir
                moveEntity(g);
                // Collision
                let dx = g.x - pacman.x, dy = g.y - pacman.y;
                if(Math.sqrt(dx*dx + dy*dy) < 1) {
                    gameState.lives--;
                    updateUI();
                    if(gameState.lives <= 0) setGameOver();
                    else { pacman.x = 13.5; pacman.y = 23; }
                }
            });
        }
        
        function moveEntity(e) {
            // 0:Right, 1:Down, 2:Left, 3:Up
            let dx=0, dy=0;
            if(e.dir === undefined) e.dir = 0;
            // Check next dir for pacman
            if(e.nextDir !== undefined && canMove(e.x, e.y, e.nextDir)) e.dir = e.nextDir;
            
            if(e.dir===0) dx=e.speed;
            if(e.dir===1) dy=e.speed;
            if(e.dir===2) dx=-e.speed;
            if(e.dir===3) dy=-e.speed;
            
            if(canMove(e.x + dx, e.y + dy, e.dir)) {
                e.x += dx; e.y += dy;
            }
        }
        
        function canMove(x, y, dir) {
            // Check center point ahead
            let checkX = Math.round(x), checkY = Math.round(y);
            if(dir===0) checkX = Math.ceil(x + 0.1);
            if(dir===1) checkY = Math.ceil(y + 0.1);
            if(dir===2) checkX = Math.floor(x - 0.1);
            if(dir===3) checkY = Math.floor(y - 0.1);
            
            if(checkY < 0 || checkY >= PMAP.length) return false;
            let char = PMAP[checkY][checkX];
            return char !== 'W';
        }

        function drawPacman() {
            ctx.fillStyle = "black"; ctx.fillRect(0,0,448,496);
            
            // Map
            for(let y=0; y<PMAP.length; y++) {
                for(let x=0; x<PMAP[y].length; x++) {
                    let c = PMAP[y][x];
                    if(c==='W') {
                        ctx.strokeStyle = "blue"; ctx.lineWidth=2;
                        ctx.strokeRect(x*16+4, y*16+4, 8, 8); // Simplified neon wall
                    } else if(c==='.') {
                        ctx.fillStyle = "#ffb897"; ctx.fillRect(x*16+6, y*16+6, 4, 4);
                    }
                }
            }
            
            // Pacman
            ctx.fillStyle = "yellow";
            ctx.beginPath();
            ctx.arc(pacman.x*16+8, pacman.y*16+8, 7, 0.2*Math.PI, 1.8*Math.PI);
            ctx.lineTo(pacman.x*16+8, pacman.y*16+8);
            ctx.fill();
            
            // Ghosts
            ghosts.forEach(g => {
                ctx.fillStyle = g.color;
                ctx.beginPath();
                ctx.arc(g.x*16+8, g.y*16+8, 7, 0, Math.PI*2);
                ctx.fill();
            });
        }

        /* --- ORTAK GÜNCELLEME VE GİRDİLER --- */
        function update(dt) {
            if(activeGame === 'snake') updateSnake(dt);
            else if(activeGame === 'tetris') updateTetris(dt);
            else if(activeGame === 'pacman') updatePacman(dt);
        }

        function draw() {
            if(activeGame === 'snake') drawSnake();
            else if(activeGame === 'tetris') drawTetris();
            else if(activeGame === 'pacman') drawPacman();
        }

        function handleInput(key) {
            if(activeGame === 'snake') {
                if(key==="ArrowLeft" && snakeDir.x!==1) snakeDir = {x:-1, y:0};
                if(key==="ArrowRight" && snakeDir.x!==-1) snakeDir = {x:1, y:0};
                if(key==="ArrowUp" && snakeDir.y!==1) snakeDir = {x:0, y:-1};
                if(key==="ArrowDown" && snakeDir.y!==-1) snakeDir = {x:0, y:1};
            } else if(activeGame === 'tetris') {
                if(key==="ArrowLeft") movePiece(-1, 0);
                if(key==="ArrowRight") movePiece(1, 0);
                if(key==="ArrowDown") movePiece(0, 1);
                if(key==="ArrowUp") rotatePiece();
                if(key===" ") hardDrop(); // Space for hard drop
            } else if(activeGame === 'pacman') {
                if(key==="ArrowRight") pacman.nextDir = 0;
                if(key==="ArrowDown") pacman.nextDir = 1;
                if(key==="ArrowLeft") pacman.nextDir = 2;
                if(key==="ArrowUp") pacman.nextDir = 3;
            }
        }

        document.addEventListener('keydown', (e) => {
            handleInput(e.key);
        });

        // --- PARTİKÜL SİSTEMİ (Snake İçin) ---
        function spawnParticles(x, y, color) {
            for(let i=0; i<10; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random()-0.5)*4, vy: (Math.random()-0.5)*4,
                    life: 1.0, color: color
                });
            }
        }
        function updateParticles() {
            particles.forEach(p => { p.x+=p.vx; p.y+=p.vy; p.life-=0.05; });
            particles = particles.filter(p => p.life > 0);
        }
        function drawParticles() {
            particles.forEach(p => {
                ctx.globalAlpha = p.life; ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 4, 4);
            });
            ctx.globalAlpha = 1.0;
        }

    </script>
</body>
</html>
